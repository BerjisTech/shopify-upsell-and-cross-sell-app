if (!window.jQuery) {
    var script = document.createElement('script');
    script.type = "text/javascript";
    script.src = "https://code.jquery.com/jquery-3.5.1.min.js";
    script.integrity = "sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    script.crossOrigin = "anonymous"
    document.getElementsByTagName('head')[0].appendChild(script);
}

const oc1 = "";
const oc2 = "";
const oc3 = "";
const oc4 = "";
const oc5 = "";
const oc6 = "";
const oc7 = "";
const oc8 = "";
const oc9 = "";
const oc10 = "";
const oc11 = "";
const oc12 = "";
const oc13 = "";
const oc14 = "";
const oc15 = "";
const oc16 = "";
const oc17 = "";
const oc18 = "";
const oc19 = "";

jQuery(document).ready(function () {
    $('head').append('<style>.sleekOffer *{opacity: 1 !important;}.tab-lg-1,.tab-lg-10,.tab-lg-11,.tab-lg-12,.tab-lg-2,.tab-lg-3,.tab-lg-4,.tab-lg-5,.tab-lg-6,.tab-lg-7,.tab-lg-8,.tab-lg-9,.tab-md-1,.tab-md-10,.tab-md-11,.tab-md-12,.tab-md-2,.tab-md-3,.tab-md-4,.tab-md-5,.tab-md-6,.tab-md-7,.tab-md-8,.tab-md-9,.tab-sm-1,.tab-sm-10,.tab-sm-11,.tab-sm-12,.tab-sm-2,.tab-sm-3,.tab-sm-4,.tab-sm-5,.tab-sm-6,.tab-sm-7,.tab-sm-8,.tab-sm-9,.tab-xs-1,.tab-xs-10,.tab-xs-11,.tab-xs-12,.tab-xs-2,.tab-xs-3,.tab-xs-4,.tab-xs-5,.tab-xs-6,.tab-xs-7,.tab-xs-8,.tab-xs-9{position:relative;min-height:1px;padding-left:15px;padding-right:15px}.tab-xs-1,.tab-xs-10,.tab-xs-11,.tab-xs-12,.tab-xs-2,.tab-xs-3,.tab-xs-4,.tab-xs-5,.tab-xs-6,.tab-xs-7,.tab-xs-8,.tab-xs-9{float:left}.tab-xs-12{width:100%}.tab-xs-11{width:91.66666667%}.tab-xs-10{width:83.33333333%}.tab-xs-9{width:75%}.tab-xs-8{width:66.66666667%}.tab-xs-7{width:58.33333333%}.tab-xs-6{width:50%}.tab-xs-5{width:41.66666667%}.tab-xs-4{width:33.33333333%}.tab-xs-3{width:25%}.tab-xs-2{width:16.66666667%}.tab-xs-1{width:8.33333333%}.tab-xs-pull-12{right:100%}.tab-xs-pull-11{right:91.66666667%}.tab-xs-pull-10{right:83.33333333%}.tab-xs-pull-9{right:75%}.tab-xs-pull-8{right:66.66666667%}.tab-xs-pull-7{right:58.33333333%}.tab-xs-pull-6{right:50%}.tab-xs-pull-5{right:41.66666667%}.tab-xs-pull-4{right:33.33333333%}.tab-xs-pull-3{right:25%}.tab-xs-pull-2{right:16.66666667%}.tab-xs-pull-1{right:8.33333333%}.tab-xs-pull-0{right:auto}.tab-xs-push-12{left:100%}.tab-xs-push-11{left:91.66666667%}.tab-xs-push-10{left:83.33333333%}.tab-xs-push-9{left:75%}.tab-xs-push-8{left:66.66666667%}.tab-xs-push-7{left:58.33333333%}.tab-xs-push-6{left:50%}.tab-xs-push-5{left:41.66666667%}.tab-xs-push-4{left:33.33333333%}.tab-xs-push-3{left:25%}.tab-xs-push-2{left:16.66666667%}.tab-xs-push-1{left:8.33333333%}.tab-xs-push-0{left:auto}.tab-xs-offset-12{margin-left:100%}.tab-xs-offset-11{margin-left:91.66666667%}.tab-xs-offset-10{margin-left:83.33333333%}.tab-xs-offset-9{margin-left:75%}.tab-xs-offset-8{margin-left:66.66666667%}.tab-xs-offset-7{margin-left:58.33333333%}.tab-xs-offset-6{margin-left:50%}.tab-xs-offset-5{margin-left:41.66666667%}.tab-xs-offset-4{margin-left:33.33333333%}.tab-xs-offset-3{margin-left:25%}.tab-xs-offset-2{margin-left:16.66666667%}.tab-xs-offset-1{margin-left:8.33333333%}.tab-xs-offset-0{margin-left:0}@media (min-width:768px){.tab-sm-1,.tab-sm-10,.tab-sm-11,.tab-sm-12,.tab-sm-2,.tab-sm-3,.tab-sm-4,.tab-sm-5,.tab-sm-6,.tab-sm-7,.tab-sm-8,.tab-sm-9{float:left}.tab-sm-12{width:100%}.tab-sm-11{width:91.66666667%}.tab-sm-10{width:83.33333333%}.tab-sm-9{width:75%}.tab-sm-8{width:66.66666667%}.tab-sm-7{width:58.33333333%}.tab-sm-6{width:50%}.tab-sm-5{width:41.66666667%}.tab-sm-4{width:33.33333333%}.tab-sm-3{width:25%}.tab-sm-2{width:16.66666667%}.tab-sm-1{width:8.33333333%}.tab-sm-pull-12{right:100%}.tab-sm-pull-11{right:91.66666667%}.tab-sm-pull-10{right:83.33333333%}.tab-sm-pull-9{right:75%}.tab-sm-pull-8{right:66.66666667%}.tab-sm-pull-7{right:58.33333333%}.tab-sm-pull-6{right:50%}.tab-sm-pull-5{right:41.66666667%}.tab-sm-pull-4{right:33.33333333%}.tab-sm-pull-3{right:25%}.tab-sm-pull-2{right:16.66666667%}.tab-sm-pull-1{right:8.33333333%}.tab-sm-pull-0{right:auto}.tab-sm-push-12{left:100%}.tab-sm-push-11{left:91.66666667%}.tab-sm-push-10{left:83.33333333%}.tab-sm-push-9{left:75%}.tab-sm-push-8{left:66.66666667%}.tab-sm-push-7{left:58.33333333%}.tab-sm-push-6{left:50%}.tab-sm-push-5{left:41.66666667%}.tab-sm-push-4{left:33.33333333%}.tab-sm-push-3{left:25%}.tab-sm-push-2{left:16.66666667%}.tab-sm-push-1{left:8.33333333%}.tab-sm-push-0{left:auto}.tab-sm-offset-12{margin-left:100%}.tab-sm-offset-11{margin-left:91.66666667%}.tab-sm-offset-10{margin-left:83.33333333%}.tab-sm-offset-9{margin-left:75%}.tab-sm-offset-8{margin-left:66.66666667%}.tab-sm-offset-7{margin-left:58.33333333%}.tab-sm-offset-6{margin-left:50%}.tab-sm-offset-5{margin-left:41.66666667%}.tab-sm-offset-4{margin-left:33.33333333%}.tab-sm-offset-3{margin-left:25%}.tab-sm-offset-2{margin-left:16.66666667%}.tab-sm-offset-1{margin-left:8.33333333%}.tab-sm-offset-0{margin-left:0}}@media (min-width:992px){.tab-md-1,.tab-md-10,.tab-md-11,.tab-md-12,.tab-md-2,.tab-md-3,.tab-md-4,.tab-md-5,.tab-md-6,.tab-md-7,.tab-md-8,.tab-md-9{float:left}.tab-md-12{width:100%}.tab-md-11{width:91.66666667%}.tab-md-10{width:83.33333333%}.tab-md-9{width:75%}.tab-md-8{width:66.66666667%}.tab-md-7{width:58.33333333%}.tab-md-6{width:50%}.tab-md-5{width:41.66666667%}.tab-md-4{width:33.33333333%}.tab-md-3{width:25%}.tab-md-2{width:16.66666667%}.tab-md-1{width:8.33333333%}.tab-md-pull-12{right:100%}.tab-md-pull-11{right:91.66666667%}.tab-md-pull-10{right:83.33333333%}.tab-md-pull-9{right:75%}.tab-md-pull-8{right:66.66666667%}.tab-md-pull-7{right:58.33333333%}.tab-md-pull-6{right:50%}.tab-md-pull-5{right:41.66666667%}.tab-md-pull-4{right:33.33333333%}.tab-md-pull-3{right:25%}.tab-md-pull-2{right:16.66666667%}.tab-md-pull-1{right:8.33333333%}.tab-md-pull-0{right:auto}.tab-md-push-12{left:100%}.tab-md-push-11{left:91.66666667%}.tab-md-push-10{left:83.33333333%}.tab-md-push-9{left:75%}.tab-md-push-8{left:66.66666667%}.tab-md-push-7{left:58.33333333%}.tab-md-push-6{left:50%}.tab-md-push-5{left:41.66666667%}.tab-md-push-4{left:33.33333333%}.tab-md-push-3{left:25%}.tab-md-push-2{left:16.66666667%}.tab-md-push-1{left:8.33333333%}.tab-md-push-0{left:auto}.tab-md-offset-12{margin-left:100%}.tab-md-offset-11{margin-left:91.66666667%}.tab-md-offset-10{margin-left:83.33333333%}.tab-md-offset-9{margin-left:75%}.tab-md-offset-8{margin-left:66.66666667%}.tab-md-offset-7{margin-left:58.33333333%}.tab-md-offset-6{margin-left:50%}.tab-md-offset-5{margin-left:41.66666667%}.tab-md-offset-4{margin-left:33.33333333%}.tab-md-offset-3{margin-left:25%}.tab-md-offset-2{margin-left:16.66666667%}.tab-md-offset-1{margin-left:8.33333333%}.tab-md-offset-0{margin-left:0}}@media (min-width:1200px){.tab-lg-1,.tab-lg-10,.tab-lg-11,.tab-lg-12,.tab-lg-2,.tab-lg-3,.tab-lg-4,.tab-lg-5,.tab-lg-6,.tab-lg-7,.tab-lg-8,.tab-lg-9{float:left}.tab-lg-12{width:100%}.tab-lg-11{width:91.66666667%}.tab-lg-10{width:83.33333333%}.tab-lg-9{width:75%}.tab-lg-8{width:66.66666667%}.tab-lg-7{width:58.33333333%}.tab-lg-6{width:50%}.tab-lg-5{width:41.66666667%}.tab-lg-4{width:33.33333333%}.tab-lg-3{width:25%}.tab-lg-2{width:16.66666667%}.tab-lg-1{width:8.33333333%}.tab-lg-pull-12{right:100%}.tab-lg-pull-11{right:91.66666667%}.tab-lg-pull-10{right:83.33333333%}.tab-lg-pull-9{right:75%}.tab-lg-pull-8{right:66.66666667%}.tab-lg-pull-7{right:58.33333333%}.tab-lg-pull-6{right:50%}.tab-lg-pull-5{right:41.66666667%}.tab-lg-pull-4{right:33.33333333%}.tab-lg-pull-3{right:25%}.tab-lg-pull-2{right:16.66666667%}.tab-lg-pull-1{right:8.33333333%}.tab-lg-pull-0{right:auto}.tab-lg-push-12{left:100%}.tab-lg-push-11{left:91.66666667%}.tab-lg-push-10{left:83.33333333%}.tab-lg-push-9{left:75%}.tab-lg-push-8{left:66.66666667%}.tab-lg-push-7{left:58.33333333%}.tab-lg-push-6{left:50%}.tab-lg-push-5{left:41.66666667%}.tab-lg-push-4{left:33.33333333%}.tab-lg-push-3{left:25%}.tab-lg-push-2{left:16.66666667%}.tab-lg-push-1{left:8.33333333%}.tab-lg-push-0{left:auto}.tab-lg-offset-12{margin-left:100%}.tab-lg-offset-11{margin-left:91.66666667%}.tab-lg-offset-10{margin-left:83.33333333%}.tab-lg-offset-9{margin-left:75%}.tab-lg-offset-8{margin-left:66.66666667%}.tab-lg-offset-7{margin-left:58.33333333%}.tab-lg-offset-6{margin-left:50%}.tab-lg-offset-5{margin-left:41.66666667%}.tab-lg-offset-4{margin-left:33.33333333%}.tab-lg-offset-3{margin-left:25%}.tab-lg-offset-2{margin-left:16.66666667%}.tab-lg-offset-1{margin-left:8.33333333%}.tab-lg-offset-0{margin-left:0}}img{border:0}img{page-break-inside:avoid}img{max-width:100%!important}.carousel-inner>.item>a>img,.carousel-inner>.item>img,.img-responsive,.thumbnail a>img,.thumbnail>img{display:block;max-width:100%;height:auto}.img-rounded{border-radius:3px}.img-thumbnail{padding:4px;line-height:1.42857143;background-color:#fff;border:1px solid #ededf0;border-radius:3px;-webkit-transition:all .2s ease-in-out;-o-transition:all .2s ease-in-out;transition:all .2s ease-in-out;display:inline-block;max-width:100%;height:auto}.img-circle{border-radius:50%}.form-control{display:block;width:100%;height:31px;padding:6px 12px;font-size:12px;line-height:1.42857143;color:#555;background-color:#fff;background-image:none;border:1px solid #ebebeb;border-radius:3px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075);-webkit-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;-o-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.form-control:focus{border-color:#cbd0d9;outline:0;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(203,208,217,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(203,208,217,.6)}.form-control::-moz-placeholder{color:#999;opacity:1}.form-control:-ms-input-placeholder{color:#999}.form-control::-webkit-input-placeholder{color:#999}.form-control::-ms-expand{border:0;background-color:transparent}.form-control[disabled],.form-control[readonly],fieldset[disabled] .form-control{background-color:#eee;opacity:1}.form-control[disabled],fieldset[disabled] .form-control{cursor:not-allowed}textarea.form-control{height:auto}input[type=search]{-webkit-appearance:none}@media screen and (-webkit-min-device-pixel-ratio:0){input[type=date].form-control,input[type=datetime-local].form-control,input[type=month].form-control,input[type=time].form-control{line-height:31px}.input-group-sm input[type=date],.input-group-sm input[type=datetime-local],.input-group-sm input[type=month],.input-group-sm input[type=time],input[type=date].input-sm,input[type=datetime-local].input-sm,input[type=month].input-sm,input[type=time].input-sm{line-height:28px}.input-group-lg input[type=date],.input-group-lg input[type=datetime-local],.input-group-lg input[type=month],.input-group-lg input[type=time],input[type=date].input-lg,input[type=datetime-local].input-lg,input[type=month].input-lg,input[type=time].input-lg{line-height:42px}}.btn{display:inline-block;margin-bottom:0;font-weight:400;text-align:center;vertical-align:middle;touch-action:manipulation;cursor:pointer;background-image:none;border:1px solid transparent;white-space:nowrap;padding:6px 12px;font-size:12px;line-height:1.42857143;border-radius:3px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.btn.active.focus,.btn.active:focus,.btn.focus,.btn:active.focus,.btn:active:focus,.btn:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}.btn.focus,.btn:focus,.btn:hover{color:#303641;text-decoration:none}.btn.active,.btn:active{outline:0;background-image:none;-webkit-box-shadow:inset 0 3px 5px rgba(0,0,0,.125);box-shadow:inset 0 3px 5px rgba(0,0,0,.125)}.btn.disabled,.btn[disabled],fieldset[disabled] .btn{cursor:not-allowed;opacity:.65;-webkit-box-shadow:none;box-shadow:none}</style>');
    $('head').append('<style>.sleek-upsell{display: table; width: auto; max-width: 100%;z-index:2000;background:#FAFAFA; font-family: inherit; color: inherit;}.card{color: #333333; display: table; width: 100%;}</style>');

    var sleek_offer = jQuery('<div class="card sleek-upsell row">'
        + '<form class="tab-xs-12" method="post" accept-charset="UTF-8" enctype="multipart/form-data" action="/cart/add">'
        + '<div class="tab-sm-4 tab-xs-6">'
        + '<img src="https://cdn.shopify.com/s/files/1/0295/4815/0859/products/man-adjusts-blue-tuxedo-bowtie_925x_656f2a36-34a8-4db2-9701-c01e49e9e5c0_x190.jpg?v=1590595412" class="img img-responsive"/>'
        + '</div>'
        + '<div class="tab-sm-5 tab-xs-6">'
        + '<div class="tab-xs-12">'
        + 'Need a free shipping?'
        + '</div>'
        + '<div class="tab-xs-12">'
        + 'Blue Silk Tuxedo'
        + '</div>'
        + '<div class="tab-xs-12" style="margin: 0px; padding: 0px;">'
        + '<div class="tab-xs-9" style="margin: 0px; padding: 0px;">'
        + '<select name="id[]" class="form-control" style="margin: 0px; ">'
        + '<option value="32337483432011">small</option>'
        + '<option value="32337483464779">large</option>'
        + '<option value="32337483497547">xl</option>'
        + '</select>'
        + '</div>'
        + '<div class="tab-xs-3" style="margin: 0px; padding: 0px;">'
        + '<select class="form-control" name="quantity" style="margin: 0px; ">'
        + '<option value="1">1</option>'
        + '<option value="2">2</option>'
        + '<option value="3">3</option>'
        + '</select>'
        + '</div>'
        + '</div>'
        + '</div>'
        + '<div class="tab-sm-3">'
        + '<span>$ 200</span>'
        + '<input onclick="addProduct(1, this.form); return false;" type="submit" class="tab-xs-12 form-controll btn" value="ADD TO CART"/>'
        + '</div>'
        + '</form>'
        + '</div>').eq(0);

    sleek_offer.insertBefore('.cart-drawer__item-list');
    sleek_offer.insertBefore('form[action="/cart"]');

    var products_array = null;
    var offers_array = null;
    var offers_url = 'https://sleek-upsell.herokuapp.com/offers/' + Shopify.shop;

    function createCORSRequest(method, url) {
        var xhr = new XMLHttpRequest();
        if ("withCredentials" in xhr) {
            xhr.open(method, url, true);
        } else if (typeof XDomainRequest != "undefined") {
            xhr = new XDomainRequest();
            xhr.open(method, url);
        } else {
            xhr = null;
        }
        return xhr;
    }
    //var request = createCORSRequest("GET", "https://api.teletext.io/api/v1/geo-ip");
    var location_request = createCORSRequest("GET", "https://json.geoiplookup.io/");
    var offers_request = createCORSRequest("GET", offers_url);
    var cart_request = createCORSRequest("GET", "https://" + Shopify.shop + "/cart.js");

    if (location_request && offers_request && cart_request) {
        offers_request.onload = function () {
            // console.log(location_request.responseText);
            // console.log(offers_request.responseText);
            // console.log(cart_request.responseText);
            // var location_data = JSON.parse(location_request.responseText);
            // var continent_code = location_data['continent_code'];

            var offers = offers_request.responseText;
            loadOffer(offers);
        };
        location_request.send();
        offers_request.send();
        cart_request.send();
    }
});

function checkArraysExists(offers) {

    var cart_products = [];
    var products_checker = [];
    var counter = 0;
    const offer_raw = JSON.parse(offers);
    const offer_array = offer_raw['offers'];

    fetch('/cart.js')
        .then(response => response.json())
        .then(data => {

            var cart_items = data.items;
            console.log("Offers\n");
            console.log(offer_array);
            console.log("Cart items\n");
            console.log(cart_items);

            let checker = (arr, target) => target.every(v => arr.includes(v));

            $(cart_items).each(function (i) {
                cart_products.push(cart_items[i]["product_id"]);
            });

            console.log("Cart products\n");
            console.log(cart_products);

            $(offer_array).each(function (i) {

                var offer_products = JSON.parse(offer_array[i]['offer_products']);
                console.log("Offer products\n");
                console.log(offer_products);
                console.log(offer_products.length);

                $(offer_products).each(function (i) {

                    products_checker[i] = Number(offer_products[i]['product_id']);
                });

                console.log("products checker " + counter);
                console.log(products_checker);
                console.log(checker(cart_products, products_checker));
            });
        });
}

function loadOffer(offers) {
    var cart_products = [];
    const offer_raw = JSON.parse(offers);
    const offer_array = offer_raw['offers'];
    fetch('/cart.js')
        .then(response => response.json())
        .then(data => {
            var cart_items = data.items;
            $(cart_items).each(function (i) {
                cart_products.push(cart_items[i]["product_id"]);
            });
            $(offer_array).each(function (i) {
                var offer_products = JSON.parse(offer_array[i]['offer_products']);
                $(offer_products).each(function (i) {
                    var offer_conditions = JSON.parse(offer_array[i]['offer_conditions']);
                    var offer_conditions = JSON.parse(offer_array[i]['offer_conditions']);
                });
            });
        });
}

function addProduct(offer_id, form) {
    alert("Submiting " + offer_id);
    $.ajax({
        type: 'POST',
        url: '/cart/add.js',
        dataType: 'json',
        data: form.serialize(),
        success: addToCartOk,
        error: addToCartFail
    });
    return false;
}